### 网络编程

#### 参考资料
1. [协议森林系列](https://www.cnblogs.com/vamei/archive/2012/12/05/2802811.html)
1. [计算机网络基础知识总结](http://www.cnblogs.com/maybe2030/p/4781555.html)

#### 网络的应用范围和架构层级，可以分成三个部分
1. SAN - System Area Network，系统区域网络 
  * 是为在群集环境(服务器到服务器)、多处理系统(处理机到处理机)和SAN(存储区域网络)中的高速互联设计的比较局部的网络。
  * 该体系结构是目前几乎独占的交换结构。
  * Switched Ethernet, Quadrics QSW, …
1. LAN - Local Area Network，局域网
  * Ethernet
1. WAN - Wide Area Network，广域网，外网
  * High speed point-to-point phone lines

#### 网络的三个层级
1. Ethernet Segment：若干主机(hosts)通过交换机(hub)连接
  * Hub 会把每个端口发来的所有数据复制到其他的端口，所有的主机都可以看到所有的数据
1. Bridged Ethernet Segment：若干(ethernet segment)通过bridge来连接
  * Bridge 知道从某端口出发可达的主机，并有选择的在端口间复制数据
1. internets：若干 LAN 通过 router 来进行物理上的连接（注意大写的 Internet 才是最互联网）

#### LAN 和 WAN 通讯需要遵守的协议
1. 提供 naming scheme
  * 定义 host address 格式
  * 每个主机和路由器都至少有一个独立的 internet 地址
1. 提供 delivery mechanism
  * 定义了标准的传输单元 - packet
  * Packet 包含 header 和 payload
    1. header 包括 packet size, source 和 destination address
    1. payload 包括需要传输的数据

#### TCP/IP 协议族：
1. IP (Internet Protocol)
  * Provides basic naming scheme and unreliable delivery capability of packets (datagrams) from host-to-host
1. UDP (Unreliable Datagram Protocol)
  * Uses IP to provide unreliable datagram delivery from process-to-process
1. TCP (Transmission Control Protocol)
  * Uses IP to provide reliable byte streams from process-to-process over connections  

#### 协议森林-TCP/IP五层模型
1. 物理层：是指光纤、电缆或者电磁波等真实存在的物理媒介。
1. 连接层：就像是一个社区的邮差，只负责在本社区送信(帧)，连接层不关心数据中到底包含什么。
1. 网络层：需要解决不同社区间的人的通讯问题。不同社区的信先到达社区的邮局，再由邮差送信。
1. 传输层：比如TCP和UDP，使用端口号(port number)来识别收信人(某个进程)
1. 应用层：比如用于Web浏览的HTTP协议，用于传输文件的FTP协议，用于Email的IMAP等

#### 协议森林-连接层
1. 以太网和WiFi是连接层的两种协议。
1. 以太网的帧格式：
  * Preamble：7字节，每个字节都是0xAA，方便接收端不断微调自己的接收频率
  * SFD(start frame delimiter)：起始信号，固定是0xAB
  * DST(destination)：目的地mac地址，6字节
  * SRC(source)：发出地mac地址，6字节
  * Type：用以说明数据部分的类型。(比如0x0800为IPv4，0x0806为ARP)
  * Payload：数据部分
  * FCS(Frame Check Sequence)：校验码，使用CRC算法

#### 协议森林-网络层
1. 无论是TCP还是UDP，必须通过网络层的IP数据包(datagram)来传递信息
1. routing table：路由表，用目标ip和路由表进行匹配，确定目标ip是在本地网络还是需要经路由器传送
1. ARP协议：主机发送ARP包，以广播的形式询问局域网上所有的主机和路由：我的mac地址是xx，ip是xx，目标ip的mac是多少？
1. routing table更新机制：当某个链路失效或更改时会广播更新信息；当有新的节点加入时也会广播
1. IPv6的主要目的是增加IPv4的地址容量，同时做了一些改进，比如避免碎片化，比如取消checksum
  * 碎片化：不同的局域网支持的MTU不一样，ipv4传输时遇到小的MTU网络需要拆包传输，ipv4则在传输前检查整个链路的MTU，避免碎片化传输
  * ipv6取消了checksum，包的校验依赖高层的协议来完成
1. ICMP基于IP协议，一个ICMP包需要封装在IP包中
1. ICMP传输的信息可以分为两类：
  * 一类是错误(error)信息：通过ICMP包，下游的路由器和主机可以将错误信息汇报给上游
  * 一类信息是咨询(Informational)性质的，比如某台计算机询问路径上的每个路由器都是谁，然后各个路由器同样用ICMP包回答
1. ICMP协议是实现ping命令和traceroute命令的基础
1. ICMP包常见的类型
  * 回音(Echo)：发出地发送Echo-询问类型的ICMP包，目的地回复Echo-回答类型的ICMP包，并将询问ICMP包包含在数据部分
  * 源头冷却(source quench)：属于错误信息，如果某个主机快速的向目的地传送数据，而目的地主机没有匹配的处理能力，就发此包
  * 目的地无法到达(Destination Unreachable)：属于错误信息，如果一个路由器接收到一个没办法进一步接力的IP包，就发此包
  * 超时(Time Exceeded)：属于错误信息，IPv4中的Time to Live(TTL)递减到0了。traceroute就利用了这种类型的ICMP包，依次发TTL=1、2、3..的包
  * 重新定向(redirect)：属于错误信息，当一个路由器收到一个IP包，对照其routing table，发现自己不应该收到该IP包，就发此包

#### 协议森林-传输层

