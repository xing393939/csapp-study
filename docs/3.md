### 内存和缓存

#### 缓存类型对比
|缓存类型	|缓存内容	|缓存位置	|时钟周期	|管理者 |
|----|----|----|----|----|
|寄存器	      |4-8 字节的字	|CPU 内核	  |0	|编译器 |
|TLB	        |地址翻译	      |芯片 TLB	|0	|内存管理单元|
|L1 缓存	    |64 字节的块	  |芯片 L1 缓存|4	|硬件|
|L2 缓存	    |64 字节的块	  |芯片 L2 缓存|10|硬件|
|虚拟内存	     |4 KB 的页	    |主存	      |100|硬件+操作系统|
|缓冲区缓存    |文件的部分内容 |主存	     |100|操作系统|
|磁盘缓存	     |磁盘扇区	    |磁盘控制器	 |100,000	|磁盘固件|
|网络缓冲区缓存 |文件的部分内容|本地磁盘	  |10,000,000|NFS 客户端|
|浏览器缓存	   |网页	        |本地磁盘	   |10,000,000|网络浏览器|
|Web 缓存	    |网页	         |远程服务器磁盘|1,000,000,000|Web 代理服务器|

#### CPU访问内存和硬盘
1. [cpu访问某个内存地址期间,会产生等待吗？ - 灵剑的回答 - 知乎](https://www.zhihu.com/question/48254983/answer/109902210)
1. 访问内存不会产生CPU中断，但是会有优化手段：L1、L2缓存；等待过程中执行其他无关指令
1. 访问磁盘的过程：CPU发送读取指令给硬盘，硬盘读取数据并通过DMA把数据传输到内存中；传输完成后磁盘通过中断的方式通知CPU，然后CPU完成之后的工作

#### 缓存未命中有三种
1. 强制性失效：CPU 第一次访问相应缓存块，没有对应的缓存
1. 冲突失效：两个数组都映射到相同的地址，第一次访问是强制性失效，后面因为缓存来回替换而出现冲突失效
1. 容量失效：假设缓存32KB，数据有64KB，第一次访问是强制性失效，第二次是容量失效

#### 缓存写入
1. 如果发生写入命中，有两个策略：
  * Write-through: 命中后更新缓存，同时写入到内存中
  * Write-back: 直到这个缓存需要被置换出去才写入到内存（需要额外的 dirty bit 来表示缓存中的数据是否和内存中相同）
1. 如果发生写入Miss，有两个策略：
  * Write-allocate: 载入到缓存中，并更新缓存（如果之后还需要对其操作，这个方式就比较好）
  * No-write-allocate: 直接写入到内存中，不载入到缓存
1. 这四种策略通常的搭配是：
  * Write-through + No-write-allocate，可以保证绝对的数据一致性
  * Write-back + Write-allocate，第二种效率会比较高（通常情况下）

#### 缓存读取
1. 高速缓冲存储器的三个组成：集合、数据行、缓存块(block)
1. 缓存地址标识的三个组成：set索引、tag、block偏移量
1. 缓存查找过程：通过set索引确定要在哪个set中寻找，利用tag和该set中的每个line进行对比并找到line，再根据block偏移量确定从line的哪个位置读起

